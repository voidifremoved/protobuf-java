syntax = "proto3";

package ComprehensiveTest.V3;

option java_package = "com.rubberjam.protobuf.compiler.test.v3";
option java_outer_classname = "ComprehensiveTestV3";
option java_generic_services = false;
option cc_generic_services = false;
option optimize_for = CODE_SIZE;

// Test enum (proto3 - open enum)
enum TestEnumV3 {
  TEST_UNKNOWN = 0;
  TEST_FIRST = 1;
  TEST_SECOND = 2;
  TEST_THIRD = 3;
  // Proto3 enums are open, so unknown values are preserved
}

// Message with all field types (proto3)
message AllFieldTypesV3 {
  // Integer types
  int32 int32_field = 1;
  int64 int64_field = 2;
  uint32 uint32_field = 3;
  uint64 uint64_field = 4;
  sint32 sint32_field = 5;
  sint64 sint64_field = 6;
  fixed32 fixed32_field = 7;
  fixed64 fixed64_field = 8;
  sfixed32 sfixed32_field = 9;
  sfixed64 sfixed64_field = 10;
  
  // Floating point types
  float float_field = 11;
  double double_field = 12;
  
  // Other primitive types
  bool bool_field = 13;
  string string_field = 14;
  bytes bytes_field = 15;
  
  // Enum and message types
  TestEnumV3 enum_field = 16;
  NestedMessageV3 message_field = 17;
  
  // Repeated fields
  repeated int32 repeated_int32 = 18;
  repeated string repeated_string = 19;
  repeated TestEnumV3 repeated_enum = 20;
  repeated NestedMessageV3 repeated_message = 21;
  
  // Proto3 optional fields (explicit presence)
  optional string optional_string = 22;
  optional int32 optional_int32 = 23;
  optional bool optional_bool = 24;
  
  // Nested message
  message NestedMessageV3 {
    string nested_string = 1;
    int32 nested_int32 = 2;
    
    // Nested enum
    enum NestedEnumV3 {
      NESTED_UNKNOWN_V3 = 0;
      NESTED_FIRST_V3 = 1;
    }
    NestedEnumV3 nested_enum = 3;
  }
  
  // Nested enum
  enum NestedEnumV3 {
    NESTED_UNKNOWN_V3 = 0;
    NESTED_FIRST_V3 = 1;
  }
  NestedEnumV3 nested_enum_field = 25;
}

// Message with oneof (proto3)
message OneofMessageV3 {
  oneof test_oneof {
    string oneof_string = 1;
    int32 oneof_int32 = 2;
    TestEnumV3 oneof_enum = 3;
    AllFieldTypesV3 oneof_message = 4;
    bytes oneof_bytes = 5;
  }
  
  string regular_field = 6;
  
  // Multiple oneofs
  oneof second_oneof {
    bool oneof_bool = 7;
    double oneof_double = 8;
  }
}

// Message with map fields (proto3)
message MapMessageV3 {
  map<string, int32> string_to_int32 = 1;
  map<int32, string> int32_to_string = 2;
  map<string, TestEnumV3> string_to_enum = 3;
  map<string, AllFieldTypesV3> string_to_message = 4;
  map<bool, string> bool_to_string = 5;
  map<int64, bytes> int64_to_bytes = 6;
  map<uint32, float> uint32_to_float = 7;
  map<fixed64, double> fixed64_to_double = 8;
}

// Message with packed repeated fields (proto3 default)
message PackedMessageV3 {
  repeated int32 packed_int32 = 1 [packed = true];
  repeated int64 packed_int64 = 2 [packed = true];
  repeated uint32 packed_uint32 = 3 [packed = true];
  repeated bool packed_bool = 4 [packed = true];
  repeated TestEnumV3 packed_enum = 5 [packed = true];
  repeated fixed32 packed_fixed32 = 6 [packed = true];
  repeated float packed_float = 7 [packed = true];
  
  // Unpacked (explicit)
  repeated int32 unpacked_int32 = 8 [packed = false];
}

// Message with reserved fields (proto3)
message ReservedMessageV3 {
  reserved 2, 15, 9 to 11;
  reserved "foo", "bar";
  
  string field1 = 1;
  int32 field3 = 3;
}

// Message with any type (proto3)
message AnyMessageV3 {
  google.protobuf.Any any_field = 1;
  repeated google.protobuf.Any repeated_any = 2;
}

// Message with well-known types
message WellKnownTypesV3 {
  google.protobuf.Timestamp timestamp_field = 1;
  google.protobuf.Duration duration_field = 2;
  google.protobuf.Struct struct_field = 3;
  google.protobuf.Value value_field = 4;
  google.protobuf.ListValue list_value_field = 5;
  google.protobuf.NullValue null_value_field = 6;
  google.protobuf.Empty empty_field = 7;
  google.protobuf.FieldMask field_mask_field = 8;
  google.protobuf.Any any_field = 9;
}

// Service definition (proto3)
service TestServiceV3 {
  rpc SimpleRpc(AllFieldTypesV3) returns (AllFieldTypesV3);
  rpc StreamingRpc(stream AllFieldTypesV3) returns (stream AllFieldTypesV3);
  rpc ClientStreamingRpc(stream AllFieldTypesV3) returns (AllFieldTypesV3);
  rpc ServerStreamingRpc(AllFieldTypesV3) returns (stream AllFieldTypesV3);
  
  // Method with options
  rpc RpcWithOptions(AllFieldTypesV3) returns (AllFieldTypesV3) {
    option deprecated = true;
  }
}

// Import well-known types
import "google/protobuf/any.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/duration.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/field_mask.proto";

